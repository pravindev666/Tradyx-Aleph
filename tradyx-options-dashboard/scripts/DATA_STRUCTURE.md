# Dashboard Data Structure Reference

This document describes the complete data structure expected by the UI and generated by Python scripts.

## Main Dashboard JSON Structure

The final `dashboard.json` file (generated by `build_dashboard_json.py`) must match the `DashboardJson` type in `hooks/useDashboard.ts`.

### Root Level Fields

```json
{
  "updatedAt": "ISO 8601 UTC timestamp",
  "spot": number,
  "vix": number,
  "spotSeries": number[],
  "vixSeries": number[],
  "pcr": number,
  "maxPain": number,
  "atmStrike": number,
  "straddle": {
    "call": number,
    "put": number,
    "total": number,
    "expMovePts": number
  },
  "oi": {
    "callsTop": Array<{ "strike": number, "oi": number, "change": number }>,
    "putsTop": Array<{ "strike": number, "oi": number, "change": number }>
  },
  "ivRank": number,
  "oiMomentum": number,
  "ohlc": {
    "open": number,
    "high": number,
    "low": number,
    "close": number,
    "previousClose": number,
    "changePct": number
  },
  "vixOhlc": {
    "open": number,
    "high": number,
    "low": number,
    "close": number,
    "previousClose": number
  },
  "spotChangePct": number,
  "vixChangePct": number,
  "driftDirection": number,
  "momentumStrength": number,
  "vrpSlope": number,
  "mlPredictions": { ... },
  "volatilityIndicators": { ... }
}
```

## ML Predictions Structure

Generated by `compute_ml_predictions.py`:

```json
{
  "nextDayBias": number,
  "nextDayBiasDirection": "Bullish" | "Neutral" | "Bearish",
  "marketProbability": number,
  "marketProbabilityRegime": "Bullish" | "Neutral" | "Bearish",
  "volatilityForecast": number,
  "volatilityForecastRegime": "Calm" | "Normal" | "Stress",
  "predictedRangeUpper": number,
  "predictedRangeLower": number,
  "predictedRangeRegime": "Bullish" | "Neutral" | "Bearish",
  "volatilityRegimeForecast": number,
  "volatilityRegimeForecastCategory": "Calm" | "Normal" | "Stress",
  "updatedAt": "ISO timestamp"
}
```

## Volatility Indicators Structure

Generated by `compute_volatility_indicators.py`:

```json
{
  "realizedVol": number,
  "hvIvSpread": number,
  "volatilityRatio": number,
  "parkinsonVol20d": number,
  "parkinsonVol60d": number,
  "expectedMove1Day": number,
  "vixNiftyCorrelation": number,
  "trendConsistencyIndex": number,
  "returnQuantilePosition": number,
  "volatilityRegime": "Calm" | "Normal" | "Stress",
  "rangeCompressionIndex": number,
  "volatilityRiskPremium": number,
  "vrpSlope": number,
  "updatedAt": "ISO timestamp"
}
```

## Script Output Files

### Data Fetching Scripts

1. **`fetch_nse_chain.py`**
   - `data/chain_raw.json` - Raw NSE option chain data
   - `data/chain_meta.json` - Metadata (spot, strikes count, updatedAt)

2. **`fetch_yf.py`**
   - `data/yf.json` - Yahoo Finance data
     - `spot`, `vix`, `spotSeries`, `vixSeries`
     - `vixOhlc` - VIX OHLC data
     - `updatedAt`

3. **`fetch_predictions.py`**
   - `data/prediction_data.json` - OHLC and sector data
     - `ohlc` - NIFTY OHLC arrays
     - `returns` - NIFTY returns
     - `sectors` - Sector indices data
     - `updatedAt`

### Computation Scripts

4. **`compute_metrics.py`**
   - `data/metrics.json` - Option chain metrics
     - `spot`, `pcr`, `maxPain`, `atmStrike`
     - `straddle`, `oi`, `ivRank`, `oiMomentum`
     - `updatedAt`

5. **`compute_ml_predictions.py`**
   - `data/ml_predictions.json` - ML predictions (see structure above)

6. **`compute_volatility_indicators.py`**
   - `data/volatility_indicators.json` - 10+ volatility indicators (see structure above)

7. **`compute_breadth_momentum.py`**
   - `data/breadth_momentum.json`
     - `driftDirection`: number (EMA20 - EMA50)
     - `momentumStrength`: { "raw": number, "scaled": number }
     - `updatedAt`

8. **`build_dashboard_json.py`**
   - `data/dashboard.json` - Final consolidated data
   - `../public/data/dashboard.json` - For Next.js frontend

## Data Flow

```
1. fetch_nse_chain.py → chain_raw.json, chain_meta.json
2. fetch_yf.py → yf.json
3. fetch_predictions.py → prediction_data.json
4. compute_metrics.py (uses chain_raw.json) → metrics.json
5. compute_ml_predictions.py (uses prediction_data.json) → ml_predictions.json
6. compute_volatility_indicators.py (uses prediction_data.json, yf.json) → volatility_indicators.json
7. compute_breadth_momentum.py (uses prediction_data.json) → breadth_momentum.json
8. build_dashboard_json.py (uses all above) → dashboard.json
```

## Field Mappings

### UI Component → Data Field

- **Spot Price**: `spot`, `spotSeries`, `ohlc`, `spotChangePct`
- **India VIX**: `vix`, `vixSeries`, `vixOhlc`, `vixChangePct`
- **IV Rank**: `ivRank`
- **Range Forecast**: Calculated from `mlPredictions.predictedRangeUpper/Lower` or `straddle.expMovePts`
- **VRP Slope**: `volatilityIndicators.vrpSlope` or `vrpSlope`
- **Drift Direction**: `driftDirection`
- **Momentum Strength**: `momentumStrength`
- **Market Mood**: Calculated from `vix`, `pcr`, `ivRank`, etc. (MMI)
- **Volatility Indicators**: `volatilityIndicators.*`
- **ML Predictions**: `mlPredictions.*`

## Notes

- All timestamps use UTC ISO 8601 format: `YYYY-MM-DDTHH:MM:SS.ffffff+00:00`
- All numeric values should be standard Python `float` (not `numpy.float32`)
- Missing/null values should be `null` in JSON (not `None`)
- Arrays should be lists, not numpy arrays
- All scripts must include `updatedAt` field

